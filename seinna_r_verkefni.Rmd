---
title: "Verkefni 2"
author: 
  - name: "Brynjar Mar (bmb23), Kári Einarsson (kae44) og Indriði Már Indriðason (imi2)" 
    title: Developers
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    downcute_theme: "chaos"
    code_folding: show
    self_contained: true
    thumbnails: false
    lightbox: true
pkgdown:
  as_is: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = FALSE, warning = F, message = F)
```

```{r}
library(tidyverse)
library(ggplot2)
library(scales)
library(knitr)
library(dplyr)
library(tidyr)
```
# Hluti 1 - Gagnamöndl (10 %)

## a)
Lesið gagnasafnið inn í R/RStudio með skipuninni hér að neðan og geymið í hlut sem ber upphafsstafi þeirra sem verkefnið vinna (ef Gréta Halldórsdóttir og Sigurður Karl Jónsson eru að vinna saman skulu þau nefna hlutinn gs).

nafn_a_hlut <- read_csv2("https://ahj.hi.is/kaupskra.csv", locale = locale(encoding = "ISO8859-1"))

þar sem þið skiptið nafn_a_hlut út fyrir upphafsstafina (þó skal ekki nota íslenska stafi).
```{r}
bik <- read_csv2("https://ahj.hi.is/kaupskra.csv", locale = locale(encoding = "ISO8859-1"))
```
medaltal taknad med $\mu$

## b)
Notið filter() skipunina til að velja fullbúnar eignir (sjá fullbuid breytuna) sem eru "Fjolbyli" og "Serbyli" og byggja á  samningum sem eru er nothæfir. Yfirskrifið stóra gagnaramman í a) lið með þessum eignum.
```{r}
tegund_inni <- c("Serbyli", "Fjolbyli")
bik <- filter(bik, fullbuid==1, tegund%in%tegund_inni, onothaefur_samningur==0)
```



## c)
Búið til nýja breytu í gagnarammanum ykkar sem inniheldur fermetraverð eignanna, nefnið breytuna fermetraverd.
```{r}
bik <- mutate(bik, fermetraverd=kaupverd/einflm)
```

## d)
Búið til nýja breytu í gagnarammanum ykkar sem inniheldur árið sem eignin var seld, nefnið breytuna ar (t.d. með að nota year() fallið í lubridate pakkanum).
```{r}
bik <- mutate(bik, ar=year(utgdag))
```

## e)
Veljið ykkur þrjú póstnúmer til að vinna með. Það þurfa að vera a.m.k. 200 sérbýli í hverju póstúmeri fyrir sig. Yfirskrifið gagnaramman í b) lið með eignum úr þessum þremur póstnúmerum. Þið skulið nota þennan gagnaramma í verkefninu.
```{r}
pnr <- c(107, 105, 210)
bik <- filter(bik, postnr%in%pnr)
```

## f)
Kannið gerð breytanna í gagnarammanum ykkar og breytið ef þarf.  
```{r}
bik <- mutate(bik, emnr = factor(emnr))
bik <- mutate(bik, postnr = factor(postnr))
```

## g)
Hugsum okkur nú að eignirnar í gagnarammanum ykkar sé þýðið ykkar. Nú ætlum við að taka úrtak úr þýðinu, 200 eignir úr hverju hverfi. Það má gera á eftirfarandi hátt:

```{r}
set.seed(39)
bik %>% 
group_by(postnr) %>%
sample_n(size = 200) -> urtak
```

# Hluti 2 - Töflur (25 %)

## h) Búið til töflu sem sýnir fjölda eigna í hverfunum þremur eftir gerð eigna (sérbýli eða fjölbýli).

```{r}
bik %>%
  count(postnr, tegund) %>%
  spread(key = tegund, value = n)
```

## i) Búið til töflu sem sýnir hlutfall sérbýla og fjölbýla í hverfunum þremur. Það á s.s. að vera hægt að lesa hvert hlutfall sérbýla og fjölbýla er í hverju hverfi fyrir sig. 

```{r}
# Finna fjolda af hverri tegund i hverju  postsnr
fjoldi <- table(bik$postnr, bik$tegund)

# Hlutfall fjolda
hlutfall <- prop.table(fjoldi, margin = 1)

#  Yfir  i %
prosent <- round(hlutfall * 100, digits = 2)

prosent
```

## j) Kannið með viðeigandi tilgátuprófi hvort hlutfall fjölbýla sé misjafnt í hverfunum þremur. Sýnið úttakið úr prófinu. Eru forsendur til að nota prófið uppfylltar? Setjið tilgáturnar fram, tilgreinið gildið á prófstærðinni, p-gildið og hvaða ályktun þið dragið.

```{r}
chi_test <- chisq.test(fjoldi)
chi_test
```
Núlltilgátan er að hlutfall fjölbýla sé það sama í öllum hverfum.
Gagntilgátan er að hlutfall fjölbýla sé ekki það sama í öllum hverfum.
Fyri ofan sést að prófstærðin er `r chi_test$statistic` og p-gildið `r chi_test$p.value`.
Þar sem p-gildið er minna en 0.05 er núlltilgátu hafnað.

# Hluti 3 - Tilgatuprof (25 %)

## k) 

```{r}

```

## i) 

```{r}

```

## i) 

```{r}

```

## i) 

```{r}

```


# Hluti 4 (30%)

## n)
Teiknið viðeigandi mynd af breytunum fermetraverd og postnr
```{r}
ggplot(urtak, aes(x=postnr, y=fermetraverd)) +
  geom_boxplot() +
  scale_y_continuous(breaks=seq(0, 1000, by=100), limits=c(0, 1000)) +
  labs(title="Samband milli fermetraverðs og póstnúmers",
       x="Póstnúmer",
       y="Fermetraverð")
```

## o)
Kannið með viðeigandi tilgátuprófi hvort munur sé á meðalfermetraverði fasteigna í hverfunum þremur. Sýnið úttakið úr prófinu. Setjið tilgáturnar fram, tilgreinið gildið á prófstærðinni, p-gildið og hvaða ályktun þið dragið. Segði nokkur orð um hvort forsendur tilgátuprófsins séu uppfylltar. Þið þurfið ekki að prófa það með tilgátuprófi, nóg er að notast við myndrit (t.d. myndina í lið n).
```{r}

```

## p)
Teiknið viðeigandi mynd af breytunum einflm og kaupverd. Segið með nokkrum orðum hvort þið teljið viðeigandi að nota einfalt línulegt aðhvarf til að lýsa sambandinu á milli breytanna.
```{r}
ggplot(urtak, aes(x=einflm, y=kaupverd)) +
  geom_point() +  # Use geom_point for scatter plots
  labs(title="Samband milli einingarflatarmáls og kaupverðs",
       x="Einingarflatarmál (einflm)",
       y="Kaupverð")
```

Miðað við greinilegan breytileika í tengslum milli einingarflatarmáls og kaupverðs, virðist vera að einföld línuleg greining gæti ekki dugað til að fanga alla flækjustigið í þessu sambandi. Þetta bendir til þess að þótt viss grundvallartengsl séu til staðar, gætu aðrir þættir eða ólínulegar tengingar einnig spilað stórt hlutverk í að ákvarða kaupverð. Nánari könnun á gögnunum með tilliti til aukabreyta eða flóknari líkana gæti verið nauðsynleg til að fá heildstæðari skilning á þessum tengslum.


## q)
Smíðið einfalt aðhvarfslíkan sem lýsir sambandi stærðar og kaupverðs eigna. Með líkaninu á að vera hægt að spá fyrir um kaupverð úr frá stærð. Tilgreinið í texta hvert matið á skurðpunktinum og hallatölunni eru ásamt skýringarhlutfallinu (notið klumpakommur). Segið í örfáum orðum hvað hallatalan segir okkur í þessu tilviki.
```{r}

```




