---
title: "Verkefni 2"
author: 
  - name: "Brynjar Mar (bmb23), Kári Einarsson (kae44) og Indriði Már Indriðason (imi2)" 
    title: Developers
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    downcute_theme: "chaos"
    code_folding: show
    self_contained: true
    thumbnails: false
    lightbox: true
pkgdown:
  as_is: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = FALSE, warning = F, message = F)
```

```{r}
library(tidyverse)
library(ggplot2)
library(scales)
library(knitr)
library(dplyr)
library(tidyr)
```
# Hluti 1 - Gagnamöndl (10 %)

## a)
Lesið gagnasafnið inn í R/RStudio með skipuninni hér að neðan og geymið í hlut sem ber upphafsstafi þeirra sem verkefnið vinna (ef Gréta Halldórsdóttir og Sigurður Karl Jónsson eru að vinna saman skulu þau nefna hlutinn gs).

nafn_a_hlut <- read_csv2("https://ahj.hi.is/kaupskra.csv", locale = locale(encoding = "ISO8859-1"))

þar sem þið skiptið nafn_a_hlut út fyrir upphafsstafina (þó skal ekki nota íslenska stafi).
```{r}
bik <- read_csv2("https://ahj.hi.is/kaupskra.csv", locale = locale(encoding = "ISO8859-1"))
```
medaltal taknad med $\mu$

## b)
Notið filter() skipunina til að velja fullbúnar eignir (sjá fullbuid breytuna) sem eru "Fjolbyli" og "Serbyli" og byggja á  samningum sem eru er nothæfir. Yfirskrifið stóra gagnaramman í a) lið með þessum eignum.
```{r}
tegund_inni <- c("Serbyli", "Fjolbyli")
bik <- filter(bik, fullbuid==1, tegund%in%tegund_inni, onothaefur_samningur==0)
```



## c)
Búið til nýja breytu í gagnarammanum ykkar sem inniheldur fermetraverð eignanna, nefnið breytuna fermetraverd.
```{r}
bik <- mutate(bik, fermetraverd=kaupverd/einflm)
```

## d)
Búið til nýja breytu í gagnarammanum ykkar sem inniheldur árið sem eignin var seld, nefnið breytuna ar (t.d. með að nota year() fallið í lubridate pakkanum).
```{r}
bik <- mutate(bik, ar=year(utgdag))
```

## e)
Veljið ykkur þrjú póstnúmer til að vinna með. Það þurfa að vera a.m.k. 200 sérbýli í hverju póstúmeri fyrir sig. Yfirskrifið gagnaramman í b) lið með eignum úr þessum þremur póstnúmerum. Þið skulið nota þennan gagnaramma í verkefninu.
```{r}
pnr <- c(107, 105, 210)
bik <- filter(bik, postnr%in%pnr)
```

## f)
Kannið gerð breytanna í gagnarammanum ykkar og breytið ef þarf.  
```{r}
bik <- mutate(bik, emnr = factor(emnr))
bik <- mutate(bik, postnr = factor(postnr))
```

## g)
Hugsum okkur nú að eignirnar í gagnarammanum ykkar sé þýðið ykkar. Nú ætlum við að taka úrtak úr þýðinu, 200 eignir úr hverju hverfi. Það má gera á eftirfarandi hátt:

```{r}
set.seed(39)
bik %>% 
group_by(postnr) %>%
sample_n(size = 200) -> urtak
```

# Hluti 2 - Töflur (25 %)

## h) Búið til töflu sem sýnir fjölda eigna í hverfunum þremur eftir gerð eigna (sérbýli eða fjölbýli).

```{r}
bik %>%
  count(postnr, tegund) %>%
  spread(key = tegund, value = n)
```

## i) Búið til töflu sem sýnir hlutfall sérbýla og fjölbýla í hverfunum þremur. Það á s.s. að vera hægt að lesa hvert hlutfall sérbýla og fjölbýla er í hverju hverfi fyrir sig. 

```{r}
# Finna fjolda af hverri tegund i hverju  postsnr
fjoldi <- table(bik$postnr, bik$tegund)

# Hlutfall fjolda
hlutfall <- prop.table(fjoldi, margin = 1)

#  Yfir  i %
prosent <- round(hlutfall * 100, digits = 2)

prosent
```

## j) Kannið með viðeigandi tilgátuprófi hvort hlutfall fjölbýla sé misjafnt í hverfunum þremur. Sýnið úttakið úr prófinu. Eru forsendur til að nota prófið uppfylltar? Setjið tilgáturnar fram, tilgreinið gildið á prófstærðinni, p-gildið og hvaða ályktun þið dragið.

```{r}
chi_test <- chisq.test(fjoldi)
chi_test
```
Núlltilgátan er að hlutfall fjölbýla sé það sama í öllum hverfum.
Gagntilgátan er að hlutfall fjölbýla sé ekki það sama í öllum hverfum.
Fyri ofan sést að prófstærðin er `r chi_test$statistic` og p-gildið `r chi_test$p.value`.
Þar sem p-gildið er minna en 0.05 er núlltilgátu hafnað.

# Hluti 3 - Tilgátuprof (25 %)

## k) Kannið með viðeigandi tilgátuprófi hvort munur sé á meðalfermetraverði fasteigna eftir því hvort þær séu sérbýli eða fjölbýli. Setjið tilgáturnar fram, tilgreinið gildið á prófstærðinni, p-gildið og hvaða ályktun þið dragið.

```{r}


# Búum til tvö úrtök, eitt fyrir sérbýli og annað fyrir fjölbýli
serbýli <- filter(bik, tegund == "Serbyli")$fermetraverd
fjölbýli <- filter(bik, tegund == "Fjolbyli")$fermetraverd

# Framkvæmum t-prófið
t_test_result <- t.test(serbýli, fjölbýli, alternative = "two.sided", var.equal = TRUE)

# Prentum út niðurstöðurnar
print(t_test_result)
```

Út frá niðurstöðunum úr t-prófinu sem hefur verið framkvæmt getum við sett fram og túlkað tilgáturnar, prófstærðina, p-gildið og dregið ályktanir.

### Tilgáturnar
- *Núlltilgáta (H0):* Það er enginn munur á meðalfermetraverði milli sérbýla og fjölbýla. \(μ_{sérbýli} = μ_{fjölbýli}\)
- *Andstæð tilgáta (H1):* Það er munur á meðalfermetraverði milli sérbýla og fjölbýla. \(μ_{sérbýli} ≠ μ_{fjölbýli}\)

### Gildi á prófstærðinni
Prófstærðin (t-gildið) er *-11.6*. Þetta talar um styrk sambandsins milli hópanna; í þessu tilviki, hversu mikill munur er á meðaltölum hópanna í samanburði við staðalfrávikin.

### P-gildi
P-gildið er *minna en 2.2e-16*, sem er mun minna en algengt markmið fyrir marktækni á 0.05 (5% líkur). Þetta þýðir að líkurnar á að fá þessar eða meira öfgameiri niðurstöður, gefið að núlltilgátan sé rétt, eru mjög lágar.

### 95% Öryggisbil
95% öryggisbil fyrir muninn á meðaltölum er frá *-50.76019* til *-36.08557*. Þetta þýðir að við getum verið 95% viss um að raunverulegur munur á meðalfermetraverði milli sérbýla og fjölbýla liggi innan þessa bils. Athugið að öryggisbilið inniheldur ekki núllið, sem styður við marktækan mun.

### Sample Estimates
Meðaltal fermetraverðs fyrir sérbýli (mean of x) er *374.1030*, og fyrir fjölbýli (mean of y) er *417.5259*.

### Ályktun
Þar sem p-gildið er mjög lágt (minna en 2.2e-16), höfnum við núlltilgátunni og ályktum að marktækur munur sé á meðalfermetraverði milli sérbýla og fjölbýla. Gögnin benda til þess að meðalfermetraverð sé lægra fyrir sérbýli en fyrir fjölbýli, með marktækum mun. T-gildið og öryggisbilið gefa okkur frekari upplýsingar um stærð og átt þessa munar.


## l) Búið til nýja breytu, staerd200, sem gefur til kynna hvort eignir séu stærri eða minni en 200 fermetrar (það skiptir ekki máli í hvorum flokknum 200 fermetra eignir lenda).  Kallið flokkinn með stærri eignunum Stærri og minni eignunum Minni. Ábending: notið ifelse() til að búa til breytuna.



```{r}
bik$staerd200 <- ifelse(bik$einflm >= 200, "Stærri", "Minni")

# Skoðum fyrstu færslurnar til að sjá breytingarnar
head(bik$staerd200)
```

## m) Kannið með viðeigandi tilgátuprófi hvort munur sé á meðalfermetraverði fasteigna eftir því hvort þær séu stærri eða minni en 200 fermetrar. Setjið tilgáturnar fram, tilgreinið gildið á prófstærðinni, p-gildið og hvaða ályktun þið dragið.

```{r}

```

# Hluti 4 (30%)

## n)
Teiknið viðeigandi mynd af breytunum fermetraverd og postnr
```{r}
ggplot(urtak, aes(x=postnr, y=fermetraverd)) +
  geom_boxplot() +
  scale_y_continuous(breaks=seq(0, 1000, by=100), limits=c(0, 1000)) +
  labs(title="Samband milli fermetraverðs og póstnúmers",
       x="Póstnúmer",
       y="Fermetraverð")
```

## o)
Kannið með viðeigandi tilgátuprófi hvort munur sé á meðalfermetraverði fasteigna í hverfunum þremur. Sýnið úttakið úr prófinu. Setjið tilgáturnar fram, tilgreinið gildið á prófstærðinni, p-gildið og hvaða ályktun þið dragið. Segði nokkur orð um hvort forsendur tilgátuprófsins séu uppfylltar. Þið þurfið ekki að prófa það með tilgátuprófi, nóg er að notast við myndrit (t.d. myndina í lið n).
```{r}

```

## p)
Teiknið viðeigandi mynd af breytunum einflm og kaupverd. Segið með nokkrum orðum hvort þið teljið viðeigandi að nota einfalt línulegt aðhvarf til að lýsa sambandinu á milli breytanna.
```{r}
ggplot(urtak, aes(x=einflm, y=kaupverd)) +
  geom_point() +  # Use geom_point for scatter plots
  labs(title="Samband milli einingarflatarmáls og kaupverðs",
       x="Einingarflatarmál (einflm)",
       y="Kaupverð")
```

Miðað við greinilegan breytileika í tengslum milli einingarflatarmáls og kaupverðs, virðist vera að einföld línuleg greining gæti ekki dugað til að fanga alla flækjustigið í þessu sambandi. Þetta bendir til þess að þótt viss grundvallartengsl séu til staðar, gætu aðrir þættir eða ólínulegar tengingar einnig spilað stórt hlutverk í að ákvarða kaupverð. Nánari könnun á gögnunum með tilliti til aukabreyta eða flóknari líkana gæti verið nauðsynleg til að fá heildstæðari skilning á þessum tengslum.


## q)
Smíðið einfalt aðhvarfslíkan sem lýsir sambandi stærðar og kaupverðs eigna. Með líkaninu á að vera hægt að spá fyrir um kaupverð úr frá stærð. Tilgreinið í texta hvert matið á skurðpunktinum og hallatölunni eru ásamt skýringarhlutfallinu (notið klumpakommur). Segið í örfáum orðum hvað hallatalan segir okkur í þessu tilviki.
```{r}

```




